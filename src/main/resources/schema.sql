CREATE TABLE IF NOT EXISTS Film
(
    id_film int NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name       varchar(500) NOT NULL,
    description   varchar(200),
    release_date date,
    duration int,
    id_rating int
);

CREATE TABLE IF NOT EXISTS film_genre
(
id_genre int PRIMARY KEY,
genre_name varchar
);

CREATE TABLE IF NOT EXISTS genre
(
id_line_genre int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
id_film int,
id_genre int
);

CREATE TABLE IF NOT EXISTS rating (
id_rating int PRIMARY KEY,
rating_name varchar
);

CREATE TABLE IF NOT EXISTS Likes (
id_line_genre int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
id_film int,
id_user int,
CONSTRAINT LIKES_FK_FILM FOREIGN KEY (id_film) REFERENCES PUBLIC.FILM(id_film) 
);

CREATE TABLE IF NOT EXISTS Users (
 id_user int NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 login varchar(200) NOT NULL,
 name varchar,
 email varchar NOT NULL,
 birthday_date date
);

CREATE TABLE IF NOT EXISTS friends (
 id_user int,
 id_friends int,
 CONSTRAINT FRIENDS_FK_USERS FOREIGN KEY (id_user) REFERENCES PUBLIC.USERS(id_user)
);

CREATE TABLE IF NOT EXISTS unverified_friends (
 id_user int,
 id_friends int,
 CONSTRAINT UNVERIFIED_FRIENDS_FK_USERS FOREIGN KEY (id_user) REFERENCES PUBLIC.USERS(id_user),
 CONSTRAINT UNVERIFIED_FRIENDS_FK_USERS_FOR_FRIENDS FOREIGN KEY (id_friends) REFERENCES PUBLIC.USERS(id_user)
);

ALTER TABLE PUBLIC.GENRE ADD CONSTRAINT IF NOT EXISTS GENRE_FK FOREIGN KEY (ID_GENRE) REFERENCES PUBLIC.FILM_GENRE(ID_GENRE);
ALTER TABLE PUBLIC.GENRE ADD CONSTRAINT IF NOT EXISTS GENRE_FK_FILM FOREIGN KEY (ID_FILM) REFERENCES PUBLIC.FILM(ID_FILM);
ALTER TABLE PUBLIC.FILM ADD CONSTRAINT IF NOT EXISTS FILM_FK_RATING FOREIGN KEY (id_rating) REFERENCES PUBLIC.RATING(ID_RATING);
ALTER TABLE PUBLIC.friends ADD CONSTRAINT IF NOT EXISTS FRIENDS_FK_USERS_FOR_FRIENDS FOREIGN KEY (id_friends) REFERENCES PUBLIC.USERS(ID_USER);
ALTER TABLE PUBLIC.LIKES ADD CONSTRAINT IF NOT EXISTS LIKES_FK_USERS FOREIGN KEY (id_user) REFERENCES PUBLIC.USERS(id_user);